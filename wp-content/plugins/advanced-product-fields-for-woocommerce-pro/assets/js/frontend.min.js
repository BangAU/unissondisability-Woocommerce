var WAPF;!function(a){var e,t=((e=r.prototype).doDependencies=function(){var i=this,n="disabled";this.$parent.find("[data-wapf-d]").each(function(e,t){var a=jQuery(t),r=i.canShow(a);a[(r?"remove":"add")+"Class"]("wapf-hide"),a.find(".wapf-tf-h").prop(n,!r),a.find(".wapf-input").each(function(e,t){var a=jQuery(t);a.prop("required",!!r&&a.data("is-required")).prop(n,!r)})}),jQuery(document).trigger("wapf/dependencies")},e.canShow=function(e){var t=e.data("wapf-d");if(!Array.isArray(t))return!0;for(var a=0;a<t.length;a++)if(this.validateRuleGroup(t[a].rules))return!0;return!1},e.validateRuleGroup=function(e){void 0===e&&(e=[]);for(var t=0;t<e.length;t++)if(!a.Util.isValidRule(this.$parent,e[t].field,e[t].condition,e[t].value||""))return!1;return!0},r);function r(e){var t=this;(this.$parent=e).on("keyup change",'.wapf-input,input[name="variation_id"]',function(){t.doDependencies()}),this.doDependencies()}a.Dependencies=t}(WAPF=WAPF||{}),function(n){function e(a){a.data("wapf-iid",Math.random().toString(36).substr(2,6));var r=new n.Dependencies(a);new n.Pricing(a),new n.Quantity(a);var i=new n.ProductImage(a);n.Util.varsViaAjax(a)&&jQuery(document).on("found_variation",function(e,t){n.Util.selectedVar=t,r.doDependencies(),i.img[t.variation_id]=t,n.Pricing.calculateAll(a)}),a.on("click",".wapf-swatch",function(){var e=jQuery(this),t=e.find(".wapf-input");if(!t.is(":disabled")){function a(){e.toggleClass(r),t.prop("checked",!t.prop("checked")).trigger("change")}var r="wapf-checked",i="1"==t.data("is-required"),n=e.closest(".wapf-swatch-wrapper").find(".wapf-swatch");t.is(":radio")?i?(n.removeClass(r),t.prop("checked",!0).trigger("change"),e.addClass(r)):(n.not(e).removeClass(r),a()):a()}}),a.on("change","input[type=checkbox]",function(){var e=jQuery(this),t=e.data("maxc"),a=e.data("minc");if(a||t){var r=e.closest(".wapf-field-container").find("input[type=checkbox]"),i=r.filter("input:checked").length,n=r.not(":checked");t&&n.prop("disabled",t<=i),a&&n.prop("required",!(!e.data("is-required")&&!i)&&i<a)}}),a.on("change",".wapf-checkable input",function(){var e=jQuery(this),t=e.closest(".wapf-field-input");e.is(":radio")&&t.find(".wapf-checkable").removeClass("wapf-checked"),jQuery(this).closest(".wapf-checkable").toggleClass("wapf-checked")}),a.find(".wapf-checkboxes[data-is-required=1],.wapf-swatch-wrapper[data-is-required=1]").each(function(e,t){function a(){r.filter(":checked").length?r.not(":checked").prop("required",!1):r.first().prop("required",!0)}var r=jQuery(t).find('input[type="checkbox"]');r.on("change",a),a(),jQuery(document).on("wapf/dependencies",a)}),jQuery("body").on("adding_to_cart",function(e,t,a){if("object"!=typeof a)return a;if(-1<Object.keys(a).indexOf("wapf_field_groups"))return a;var r=t.closest("form.cart").find(".wapf-wrapper :input").serializeArray();if(!r)return a;r.forEach(function(e){if(-1<e.name.indexOf("[]")){var t=e.name.replace("[]","");a[t]||(a[t]=[]),a[t].push(e.value)}else a[e.name]=e.value})}),jQuery(document).trigger("wapf/init",[a])}n.Frontend=e}(WAPF),jQuery(function(){"product"==wapf_config.page_type?new WAPF.Frontend(jQuery("body")):jQuery("[data-product-page-preselected-id]").each(function(e,t){new WAPF.Frontend(jQuery(t))})}),function(p){var e=(h.fxPriceHints=function(e,t){var a=p.Filter.apply("wapf/fx/hint",h.getPrice(e,jQuery(t))),r=p.Util.formatMoney(a,wapf_config.display_options),i=a<0?"":"+",n=p.Filter.apply("wapf/html/fxhint",i+r);t.is("option")&&t.html(t.data("wapf-label")+" "+t.data("fx-hint").replace(/\.{3}/,n)),t.closest(".has-pricing").find(".wapf-addon-price").html(n)},h.calculateAll=function(e){var t=wapf_config.display_options,a=p.Util.currentProductPrice(e)*p.Util.selectedQuantity(e),r=this.calculateOptionTotal(e),i=a+r;i<0&&(i=0);var n=".wapf-",c=p.Util.formatMoney;e.find(n+"product-total").html(c(a,t)),e.find(n+"options-total").html(c(r,t)),e.find(n+"grand-total").html(c(i,t)),e.find(n+"product-totals").show(),jQuery(document).trigger("wapf/pricing",[a,r,a+r,e])},h.calculateOptionTotal=function(i){var n=0;return i.find("[data-wapf-price]").each(function(e,t){var a=jQuery(t),r=p.Util.getFieldType(a);"fx"===a.data("wapf-pricetype")&&h.fxPriceHints(i,a),!0!==a.prop("disabled")&&(-1<["checkbox","radio"].indexOf(r)&&!a.is(":checked")||("option"!=r||a.is(":selected")&&!0!==a.closest("select").prop("disabled"))&&a.val()&&(n+=h.getPrice(i,a)))}),n},h.getPrice=function(e,t){var a=p.Util.currentProductPrice(e),r=t.data("wapf-pricetype"),i=t.data("wapf-price"),n=t.data("wapf-label")||t.val(),c=this.toAdd(r,a,"fx"===r?i:parseFloat(i||"0"),e,t,n);return"fx"===r&&-1===i.indexOf("[price]")&&(c*=t.data("wapf-tax")),c||0},h.toAdd=function(e,d,t,o,l,u){var s=p.Util.selectedQuantity(o);switch(e){case"percent":return d*(t/100)*s;case"p":return d*(t/100);case"qt":return s*t;case"nr":return u*t;case"nrq":return u*t*s;case"char":return u.length*t;case"charq":return u.length*t*s;case"fx":var a=p.Util.replaceFx(t,s,d,u,l);return a=a.replace(/\[var_.+?]/g,function(e){var t=o.data("wapf-iid");if(h.variables[t]){var a=p.Util.first(h.variables[t],"name",e.replace(/\[var_|]/g,""));if(a){for(var r=a.default,i=l.data("clone")||0,n=0;n<a.rules.length;n++){var c=a.rules[n],f=p.Util.cloneField(c.field,o,i);if(p.Util.isValidRule(o,f,c.condition,c.value||"")){r=c.variable;break}}return p.Util.parseFx(p.Util.replaceFx(p.Util.cloneFx(r,o,i),s,d,u,l))}}return"0"}),p.Util.parseFx(a);default:return t}},h.variables=[],h);function h(e){if(e.find("[data-wapf-price]").length){var r=e.data("wapf-iid");h.variables[r]=[],e.find(".wapf-field-group").each(function(e,t){var a=jQuery(t).data("variables");a&&(h.variables[r]=h.variables[r].concat(a))}),e.on("keyup change",'.wapf-input,input[name="variation_id"]',function(){h.calculateAll(e)}),e.find("[data-qty-based]").length||e.on("keyup change",":input.qty",function(){h.calculateAll(e)}),h.calculateAll(e)}}p.Pricing=e}(WAPF),function(l){var e,t=((e=a.prototype).doImageLogic=function(e,t,a){void 0===e&&(e="rules"),void 0===a&&(a=[]);var r=this.validRule(e,t,a);if(r)this.showImage(r.image);else{var i=l.Util.selectedVariation(this.$parent);this.showImage(i?i.image_id:this.dii)}},e.validRule=function(e,t,a){for(var r=0;r<a.length;r++){for(var i=a[r],n=!0,c=0;c<i.values.length;c++){var f=i.values[c];if("*"!=f.value){var d=this.$parent.find("[data-field-id="+f.field+"]"),o=l.Util.getFieldValue(d,!0);if(!(Array.isArray(o)?-1<o.indexOf(f.value):f.value==o||1==o)||"last"===e&&f.field!=t.data("field-id")){n=!1;break}}}if(n)return i}return null},e.createImageObj=function(e){var t=this,a={image_id:e.attr("data-wapf-att-id")},r=e.find("img"),i=r.data("o_src")?"data-o_":"";return this.ma.forEach(function(e){a[e]=r.attr(i+e)}),a.thumb_src=e.data("thumb"),Object.keys(this.m).forEach(function(e){a[t.m[e]]=r.attr(i+e)}),wapf_config.slider_support||(a.srcset=" "),a},e.showImage=function(i){var n=this;setTimeout(function(){var e=n.img[parseInt(i)],t=n.$parent.find("[data-wapf-att-id="+i+"]");if(t.length&&wapf_config.slider_support){var a=n.$parent.find(".images").data("flexslider");if(a){var r=a.vars?a.vars.animationSpeed:250;return n.isFirstLoad&&(a.vars.animationSpeed=0),n.$parent.find(".flex-control-nav li").eq(jQuery("[data-wapf-att-id]").index(t)).find("img").trigger("click"),a.vars.animationSpeed=r,n.isFirstLoad=!1,n.reset()}}n.setCustomImage(e)},5)},e.setCustomImage=function(t){var a=this;this.$pi=this.$parent.find(".images .wp-post-image").eq(0),this.ma.forEach(function(e){t[e]&&a.$pi.attr(e,t[e])},this),Object.keys(this.m).forEach(function(e){a.$pi.attr(e,t[a.m[e]])});var e=this.$parent.find(".flex-control-nav li").eq(0).find("img");e.attr("src",t.thumb_src),this.$pi.closest("a").attr("href",t.full_src),this.$pi.closest("div").attr("data-wapf-att-id",t.image_id),e.trigger("click"),this.reset()},e.reset=function(){var e=this;setTimeout(function(){jQuery(window).trigger("resize"),e.$parent.find(".images").trigger("woocommerce_gallery_init_zoom")},15)},a);function a(e){var n=this;if(this.rules=[],this.img={},this.ma=["src","height","width","title","srcset","alt","sizes"],this.isFirstLoad=!0,this.m={"data-src":"full_src","data-caption":"caption","data-large_image":"full_src","data-large_image_width":"full_src_w","data-large_image_height":"full_src_h"},this.$parent=e,this.$pi=e.find(".images .wp-post-image"),this.$pi.length){var t=e.find("[data-wapf-gi]");if(t.length){jQuery(document).trigger("wapf:delete_var"),this.dii=this.$pi.closest("div").data("wapf-att-id"),this.$parent.find("[data-wapf-att-id]").each(function(e,t){var a=jQuery(t);n.img[a.data("wapf-att-id")]=n.createImageObj(a)});var a=e.find('input[name="variation_id"]');if(a.length){var r=this.$parent.find("form.cart").data("product_variations");r&&r.forEach(function(e){e.image.image_id=e.image_id,n.img[e.image_id]=e.image})}t.each(function(e,t){var a=jQuery(t),r=a.data("wapf-gi"),i=a.data("group");n.rules[i]=r.rules.reverse(),r.images.forEach(function(e){n.img[e.image_id]=e}),a.find(".wapf-input").on("change",function(e){n.doImageLogic(a.data("wapf-st"),jQuery(e.currentTarget),n.rules[i])}).filter(":visible").eq(0).trigger("change")}),a.on("change",function(){n.doImageLogic("rules",a)})}}}l.ProductImage=t}(WAPF),function(p){var e,t=((e=a.prototype).doQtyLogic=function(e){var u=this,s=p.Util.selectedQuantity(this.$parent);e.each(function(e,t){var a=jQuery(t),r=a.attr("for"),i=void 0===u.c[r]?0:u.c[r].length,n=s-(i+1),c=a.hasClass("wapf-section");if(0!=n)if(0<n)for(var f=0;f<n;f++){var d=i+f+2,o=(a.data("clone-txt")||"").replace("{n}",d),l=u.changeAttributes(a.clone(!0),d,o,c);l.insertAfter(u.c[r]&&u.c[r].length?u.c[r][u.c[r].length-1]:a),c&&o&&l.prepend('<div class="wapf-clone-title"><label>'+o+"</label></div>"),jQuery(document).trigger("wapf/cloned",[r,d,l]),u.c[r]?u.c[r].push(l):u.c[r]=[l]}else u.c[r].splice(n,Math.abs(n)).forEach(function(e){e.remove()})}),p.Pricing.calculateAll(this.$parent)},e.changeAttributes=function(o,l,e,t){function a(e){var t=e.data("wapf-d");t&&((t=JSON.parse(JSON.stringify(t))).forEach(function(e){e.rules.forEach(function(e){var t=u.$parent.find('[for="'+e.field+'"]').first();t.length&&(""==t.data("qty-based")||t.closest(".wapf-section[data-qty-based]").length)&&(e.field=e.field+"_clone_"+l)})}),e.attr("data-wapf-d",JSON.stringify(t)).data("wapf-d",t))}var u=this,r=o.find(".wapf-input,.wapf-tf-h").data("clone",l),i=o.find("[data-wapf-d]");a(o),i.each(function(e,t){a(jQuery(t))}),r.each(function(e,t){var a=jQuery(t),r=a.data(a.hasClass("wapf-tf-h")?"fid":"field-id"),i=r+"_clone_"+l;function n(e){if("fx"==e.data("wapf-pricetype")){var t=p.Util.cloneFx(e.data("wapf-price"),u.$parent,l);e.attr("data-wapf-price",t).data("wapf-price",t)}}["name","id","data-field-id","data-fid"].forEach(function(e){a.attr(e)&&a.attr(e,a.attr(e).replace(r,i))}),a.data("field-id",i),n(a),a.find("option").data("clone",l).each(function(e,t){n(jQuery(t))});var c=a.attr("id"),f=o.find('label[for="'+c+'"]');if(f.length){var d=c+"_"+l;f.attr("for",d),a.attr("id",d)}}),o.removeAttr("data-qty-based data-clone-txt");var n=o.find(".wapf-field-label label > span:first-child");return t||n.html(e),o},a);function a(e){var t=this;this.c=[];var a=(this.$parent=e).find("[data-qty-based]");a.length&&(e.on("change",":input.qty",function(){t.doQtyLogic(a)}),this.doQtyLogic(a))}p.Quantity=t}(WAPF),function(e){var t=(a.add=function(e,t){this.f[e]||(this.f[e]=[]),this.f[e].push(t)},a.apply=function(e,t,a){return this.f[e]&&this.f[e].forEach(function(e){t=e(t,a)}),t},a.f=[],a);function a(){}e.Filter=t}(WAPF),function(l){var e=(s.first=function(e,t,a){for(var r=0;r<e.length;r++)if(e[r][t]===a)return e[r];return null},s.replaceFx=function(e,t,a,r,i){return(e=e.replace(/\[qty]/g,t).replace(/\[price]/g,a).replace(/\[x]/g,r)).replace(/\[field\..+?]/g,function(e){return s.getFieldValue(jQuery("[data-field-id="+e.replace("[field.","").replace("]","")+"]"))})},s.parseFx=function(d){var o=this;return l.Filter.apply("wapf/fx/functions",["min","max","len"]).forEach(function(e){var t=e+"(",a=d.lastIndexOf(t);if(-1<a){var r=a+t.length,i=function(e,t){for(var a=1,r=0,i=t;i<e.length;i++)if("("==e[i]&&a++,")"==e[i]&&a===++r)return i;return t}(d,r),n=d.substring(r,i),c=function(e){for(var t=0,a="",r=[],i=0;i<e.length;i++)";"!=e[i]||t?("("==e[i]&&t++,")"==e[i]&&t--,a+=e[i]):(r.push(a),a="");return 0<a.length&&r.push(a),r}(n),f="";switch(e){case"len":f=(""+n).length;break;case"min":f=Math.min.apply(null,c.map(function(e){return o.parseFx(e)}));break;case"max":f=Math.max.apply(null,c.map(function(e){return o.parseFx(e)}))}d=""+o.parseFx(d.substr(0,a)+l.Filter.apply("wapf/fx/solve",f,{func:e,args:c})+d.substr(i+1))}}),this.evalFx(d)},s.evalFx=function(e){function l(e){return parseFloat(e)}function u(e,t){return-1<e.indexOf(t)}var s=function(e){var t=!1,a=!1,r=0;if(e=e.replace(/[^\d.+\-*\/()]/gi,""),u(e,"(")&&u(e,")")){var i=/\(([\d.+\-*\/]+)\)/;if(1<(f=e.match(i)||[]).length)return s(e.replace(i,s(f[1])))}if(e=e.replace("(","").replace(")",""),u(e,"/")||u(e,"*")){t=!0;for(var n=["*","/"];n.length;)for(var c=n.pop();c&&u(e,c);){var f;if(i=new RegExp("([\\d.]+)\\"+c+"(\\-?[\\d.]+)"),!(2<(f=e.match(i)||[]).length))return 0;"+"==c&&(r=l(f[1])+l(f[2])),"-"==c&&(r=l(f[1])-l(f[2])),"*"==c&&(r=l(f[1])*l(f[2])),"/"==c&&(r=l(f[1])/l(f[2])),e=(e=e.replace(i,r)).replace("++","+").replace("--","+").replace("-+","-").replace("+-","-")}}if(u(e,"+")||u(e,"-")){a=!0;var d=(e=e.replace("--","+")).match(/([\d\.]+|[\+\-])/g)||[];if(0<d.length){c="+";for(var o=r=0;o<d.length;o++)"+"==d[o]||"-"==d[o]?c=d[o]:r="+"==c?r+l(d[o]):r-l(d[o])}}return t||a||(r=l(e)),r};return s(e)},s.cloneField=function(e,t,a){if(!a)return e;var r=t.find('[for="'+e+'"]').first();return r.length&&""==r.data("qty-based")?e+"_clone_"+a:e},s.cloneFx=function(e,r,i){var n=this;return e.replace(/\[(field\.)(.+?)]/g,function(e,t,a){return"["+t+n.cloneField(a,r,i)+"]"})},s.getFieldType=function(e){if(e.is("input"))return e.data("df")?"date":e.attr("type");for(var t=["select","textarea","option"],a=0;a<t.length;a++)if(e.is(t[a]))return t[a];return""},s.getFieldValue=function(e,r){void 0===r&&(r=!1);var t=this.getFieldType(e),a=e.attr("name"),i=jQuery('input[name="'+a+'"]:checked');switch(t){case"select":var n=e.val();return r?n||"":n?e.find("option:selected").data("wapf-label"):"";case"radio":return n=i.val(),r?n||"":i.length?i.data("wapf-label"):"";case"checkbox":if("[]"!=a.substring(a.length-2,a.length))return e.is(":checked");var c=[];return i.each(function(e,t){var a=jQuery(t);c.push(r?a.val():a.data("wapf-label"))}),c;default:return e.val()}},s.selectedQuantity=function(e){var t=parseInt(e.find("[name=quantity]").val());return isNaN(t)?1:t},s.currentProductType=function(e){return e.find(".wapf-product-totals").data("product-type")},s.currentProductPrice=function(e){var t=this.selectedVariation(e),a=0;return a="variable"==this.currentProductType(e)&&t?t.display_price:e.find(".wapf-product-totals").data("product-price"),l.Filter.apply("wapf/pricing/base",a,{parent:e})},s.currentVariationId=function(e){var t=e.find('input[name="variation_id"]').val();return t?parseInt(t):0},s.varsViaAjax=function(e){return 0==e.find("[data-product_variations]").data("product_variations")},s.selectedVariation=function(e){var t=e.find("[data-product_variations]").data("product_variations");if(!t)return this.selectedVar;var a=this.currentVariationId(e);return a?s.first(t,"variation_id",a):null},s.unformat=function(e,t){if(void 0===t&&(t=","),"number"==typeof e)return e;var a=new RegExp("[^0-9-"+t+"]","g"),r=parseFloat(e.replace(/\((.*)\)/,"-$1").replace(a,"").replace(t,"."));return isNaN(r)?0:r},s.formatNumber=function(e,t,a,r){e=this.unformat(e,r);var i,n,c=(i=Math.abs(e),n=t,Number(Math.round(i+"e"+n)+"e-"+n).toFixed(n)),f=e<0?"-":"",d=parseInt(c,10)+"",o=3<d.length?d.length%3:0;return f+(o?d.substr(0,o)+a:"")+d.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+a)+(t?r+c.split(".")[1]:"")},s.formatMoney=function(e,t){return e<0&&t.format.replace("%2$s","-%2$s"),t.format.replace("%1$s",t.symbol).replace("%2$s",s.formatNumber(e,t.decimals||0,t.thousand,t.decimal))},s.isValidRule=function(e,t,a,r){var i=null;if("qty"==t)i=s.selectedQuantity(e);else{var n=e.find('[data-field-id="'+t+'"]').first();if(!n.length)return!1;if(-1<a.indexOf("product_var")||-1<a.indexOf("patts")){var c=s.currentProductType(e);if(-1===c.indexOf("variable")&&-1===c.indexOf("variation"))return!0;var f=s.selectedVariation(e);if(null==f)return!1;function d(){for(var e=0;e<o.length;e++){var t=o[e].split("|");if(f.attributes&&f.attributes["attribute_pa_"+t[0]]&&("*"==t[1]||f.attributes["attribute_pa_"+t[0]]===t[1]))return!0}return!1}var o=r.split(","),l=""+f.variation_id;switch(a){case"product_var":return-1<o.indexOf(l);case"!product_var":return-1==o.indexOf(l);case"patts":return!0===d();case"!patts":return!1===d()}}if(n.closest(".wapf-field-container").hasClass("wapf-hide"))return!1;if(i=s.getFieldValue(n,!0),"date"===s.getFieldType(n)&&r){i=n.data("selected");var u=r.split("-");r=new Date(parseInt(u[2]),parseInt(u[0])-1,parseInt(u[1]))}}switch("number"==typeof i&&(i=i.toString()),a){case"check":return 1==i;case"!check":return 0==i;case"==":return Array.isArray(i)?-1<i.indexOf(r):i instanceof Date?i&&i.getTime()===r.getTime():i==r;case"!=":return Array.isArray(i)?-1==i.indexOf(r):i instanceof Date?i&&i.getTime()!=r.getTime():i!=r;case"empty":return i==[]||""==i;case"!empty":return i!=[]&&""!=i;case"==contains":return-1<i.indexOf(r);case"!=contains":return-1===i.indexOf(r);case"lt":return parseFloat(i)<parseFloat(r);case"gt":return parseFloat(i)>parseFloat(r);case"gtd":return i&&i.getTime()>r.getTime();case"ltd":return i&&i.getTime()<r.getTime()}return!1},s.toDate=function(e,t){},s.selectedVar=null,s);function s(){}l.Util=e}(WAPF);